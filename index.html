<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Behavior Tracker</title>
  <!-- Roboto Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <!-- Tabler Icons -->
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@3.6.0/tabler-icons.min.css" rel="stylesheet">
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
  <style>
    body { font-family: 'Roboto', sans-serif; background: linear-gradient(120deg,#f7fafc,#e3e6ee 55%,#f7fafc 100%); color: #222; transition: background-color .3s, color .3s; }
    body.dark { background: linear-gradient(120deg,#232526,#28292d 55%,#232526 100%); color: #e0e0e0; }
    .container { max-width: 1200px; margin: 20px auto; padding: 0 12px; }
    h1 { text-align: center; margin-bottom: 20px; }
    .button-wrapper { text-align: center; margin-bottom: 20px; }
    .button-wrapper button { padding: 10px 20px; background: linear-gradient(90deg,#43cea2 0,#185a9d 100%); color: white; border: none; border-radius:5px; cursor:pointer; }
    .button-wrapper button:hover { background: linear-gradient(90deg,#185a9d 0,#43cea2 100%); }
    table.dataTable { width: 100% !important; }
    .dt-center { text-align: center; }
    .ti { font-size:1.3em; vertical-align:middle; margin-right:5px; opacity:.85; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ§  Documented Behavior Database</h1>
    <div class="button-wrapper">
      <button onclick="toggleDarkMode()">ðŸŒ™ Toggle Dark Mode</button>
    </div>
    <table id="dataTable" class="display nowrap"></table>
  </div>

  <!-- jQuery & DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyClJy0GHBpDHSy4b5pKM0B9bNsMHa7pxAI",
      authDomain: "behavior-database.firebaseapp.com",
      projectId: "behavior-database",
      storageBucket: "behavior-database.firebasestorage.app",
      messagingSenderId: "350774293300",
      appId: "1:350774293300:web:44e06673ae52421375eb61"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function formatTimestamp(ts) {
      try {
        if (!ts) return '';
        if (ts.toDate) return ts.toDate().toLocaleString();
        return ts;
      } catch { return ''; }
    }

    async function loadEntries() {
      const snaps = await getDocs(collection(db, "entries"));
      const data = snaps.docs.map(docSnap => {
        const e = docSnap.data();
        const icons = {
          TikTok:'<i class="ti ti-brand-tiktok"></i>',
          Instagram:'<i class="ti ti-brand-instagram"></i>',
          YouTube:'<i class="ti ti-brand-youtube"></i>',
          Discord:'<i class="ti ti-brand-discord"></i>',
          Facebook:'<i class="ti ti-brand-facebook"></i>'
        };
        const icon = icons[e.platform] || '<i class="ti ti-dots"></i>';
        return [
          e.date||'',
          icon + ' ' + (e.platform||''),
          e.behavior||'',
          e.target||'',
          e.summary||'',
          `<a href="${e.evidence||''}" target="_blank">Link</a>`,
          formatTimestamp(e.timestamp) || '',
          e.status||''
        ];
      });

      $('#dataTable').DataTable({
        data: data,
        columns: [
          { title: 'Date' },
          { title: 'Platform' },
          { title: 'Behavior' },
          { title: 'Target' },
          { title: 'Summary' },
          { title: 'Evidence', className: 'dt-center' },
          { title: 'Timestamp' },
          { title: 'Status' }
        ],
        destroy: true,
        scrollX: true,
        pageLength: 10
      });
    }

    window.onload = loadEntries;
    window.toggleDarkMode = () => document.body.classList.toggle('dark');
  </script>
</body>
</html>
